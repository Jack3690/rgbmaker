<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rgbmaker &mdash; rgbmaker 0.0.4.8 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> rgbmaker
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rgbmaker</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>rgbmaker</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for rgbmaker</h1><div class="highlight"><pre>
<span></span><span class="c1">#-- author: @avialxee ---#--#</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">units</span> <span class="k">as</span> <span class="n">ut</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astroquery.skyview</span> <span class="kn">import</span> <span class="n">SkyView</span> <span class="k">as</span> <span class="n">skv</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>

<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">simplefilter</span>
<span class="kn">from</span> <span class="nn">astroquery.nvas</span> <span class="kn">import</span> <span class="n">Nvas</span>
<span class="kn">from</span> <span class="nn">astroquery.vizier</span> <span class="kn">import</span> <span class="n">Vizier</span>

<div class="viewcode-block" id="RGBMaker"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker">[docs]</a><span class="k">class</span> <span class="nc">RGBMaker</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.12</span><span class="p">),</span> <span class="n">archives</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">imagesopt</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">px</span><span class="o">=</span><span class="mi">480</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        creating instance for variables to be used throughout the process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#--- input variables -----#-#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archives</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">archives</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">imagesopt</span><span class="p">)</span>

        <span class="c1">#--- helper &amp; output variables -----#-#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imglt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">otext</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="n">px</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inp_sanitize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_down</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="RGBMaker.throw_output"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.throw_output">[docs]</a>    <span class="k">def</span> <span class="nf">throw_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns output showing status of output. </span>
<span class="sd">        </span>
<span class="sd">        TODO </span>
<span class="sd">        ----</span>
<span class="sd">        1. Http Status-code-like json output. 200, 202, 404 etc</span>
<span class="sd">        2. Show vizier table. ex. otext[&#39;vizier]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">otext</span></div>

<div class="viewcode-block" id="RGBMaker.submit_query"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.submit_query">[docs]</a>    <span class="k">def</span> <span class="nf">submit_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        takes input of name, position, radius, choice of image and arhives </span>
<span class="sd">        to fetch FITS from Skyview and NVAS.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## ------------- Settings ---------------------</span>
        <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">VisibleDeprecationWarning</span><span class="p">)</span>
        <span class="c1">#VerifyWarning by astropy for NVSS in imagesopt=2 </span>
        <span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">_input_svys</span><span class="p">,</span> <span class="n">_input_sampler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_rgb</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inp_sanitize</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getNVAS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">archives</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hdu_d_list</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getdd</span><span class="p">(</span><span class="n">_input_svys</span><span class="p">,</span> <span class="n">_input_sampler</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;error fetching data from skyview&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;No images to return&#39;</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throw_output</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arr_rgb</span><span class="p">(</span><span class="n">_input_svys</span><span class="p">,</span> <span class="n">hdu_d_list</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Please check Coordinates&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throw_output</span><span class="p">()</span></div>
        
        <span class="c1">#return hdu_d_list #DEBUG</span>

    <span class="k">def</span> <span class="nf">_arr_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_svys</span><span class="p">,</span> <span class="n">hdu_d_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @input </span>
<span class="sd">            of svy names, data returned for surveys </span>
<span class="sd">        @returns: </span>
<span class="sd">            list containing data, range that can be used to plot in matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_svys_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">hdu_d_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">hdu_d_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">_key_svy_dict</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">_val_svy_dict</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">_svys_res</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">_start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_svys</span><span class="p">)):</span>
                    <span class="n">_ind_rgb_dict</span> <span class="o">=</span> <span class="n">_val_svy_dict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">input_svys</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">_svy_sname</span> <span class="o">=</span> <span class="n">_key_svy_dict</span><span class="p">[</span><span class="n">_ind_rgb_dict</span><span class="p">]</span>
                    <span class="n">_svys_res</span><span class="p">[</span><span class="n">_svy_sname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">hdu_d_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="s1">&#39;value ranges from </span><span class="si">{:0.4f}</span><span class="s1"> to </span><span class="si">{:0.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdu_d_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">hdu_d_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                                            <span class="p">}</span>
                    <span class="k">if</span> <span class="n">_svy_sname</span> <span class="o">==</span> <span class="s1">&#39;tgss&#39;</span> <span class="ow">or</span> <span class="n">_svy_sname</span> <span class="o">==</span> <span class="s1">&#39;nvss&#39;</span> <span class="ow">or</span> <span class="n">_svy_sname</span><span class="o">==</span><span class="s1">&#39;first&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">otext</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">input_svys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="p">:</span>  <span class="n">_svys_res</span><span class="p">[</span><span class="n">_svy_sname</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">]})</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;No images found.&quot;</span>
                <span class="n">_time_taken</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">_start</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">+=</span> <span class="s1">&#39; Time taken:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_time_taken</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;. &quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throw_output</span><span class="p">()</span>        
            <span class="k">return</span> <span class="n">_svys_res</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;No data fetched from skyview.&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">throw_output</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sanitize_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns RGB surveys as array dtype=&lt;U13 and sampler as list to be used by getdd().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_rgbs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_sampler</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
                <span class="n">_rgb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;ror&#39;</span><span class="p">)</span>
                <span class="n">_rgb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;iou&#39;</span><span class="p">)</span>
                <span class="n">_rgb3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;optical&#39;</span><span class="p">)</span>
                <span class="n">_rgbs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_rgb1</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">_rgb2</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">_rgb3</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
                <span class="n">_rgb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">)</span>
                <span class="n">_rgb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;ror&#39;</span><span class="p">)</span>
                <span class="n">_rgbs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_rgb1</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">_rgb2</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span>
                <span class="n">_rgb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb_dict</span><span class="p">(</span><span class="s1">&#39;allwise&#39;</span><span class="p">)</span>
                <span class="n">_rgbs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_rgb1</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">]))</span>

            <span class="n">_sampler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">_rgbs</span><span class="p">))</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_rgbs</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;NVSS&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">_sampler</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Lanczos3&#39;</span>
        <span class="k">return</span> <span class="n">_rgbs</span><span class="p">,</span> <span class="n">_sampler</span>

<div class="viewcode-block" id="RGBMaker.getdd"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.getdd">[docs]</a>    <span class="k">def</span> <span class="nf">getdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_svys</span><span class="p">,</span> <span class="n">sampler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        takes input svys (array) and fetches fits from skyview using astroquery.</span>
<span class="sd">        returns [list([hdulist[0].data, hdulist[0].header]), error]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_imglt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_imgls</span><span class="p">,</span> <span class="n">_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_imgl</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">input_svys</span><span class="p">,</span> <span class="n">sampler</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_imgls</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">_imgls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_imglt</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="p">))),</span> <span class="kc">None</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_imglt</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">_imgls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_imgls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">_imgls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_imglt</span><span class="p">,</span> <span class="n">_error</span></div>

    <span class="k">def</span> <span class="nf">_getNVAS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archives</span><span class="p">):</span>
        <span class="n">archives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">archives</span>
        <span class="k">if</span> <span class="n">archives</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">archives</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span>     
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">nvas_urls</span> <span class="o">=</span> <span class="n">Nvas</span><span class="o">.</span><span class="n">get_image_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ut</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nvas_urls</span><span class="p">))</span> <span class="o">+</span> \
                    <span class="s2">&quot; Image(s) found in NVAS: &quot;</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">nvas</span> <span class="ow">in</span> <span class="n">nvas_urls</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">5</span> <span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot; &lt;a href=&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nvas</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39; target=&#39;_blank&#39; rel=&#39;noreferrer noopener&#39;&gt;[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&lt;/a&gt;&quot;</span>
                        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">otext</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;NVAS&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">})</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">otext</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;NVAS&#39;</span> <span class="p">:</span> <span class="s1">&#39;NVAS server error&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_run_imgl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">_in_svys</span><span class="p">,</span> <span class="n">sam</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes coordinate, radius and surveys to be fetched from </span>
<span class="sd">        skyview and sends to _get_imgl_pool.</span>
<span class="sd">        returns a list of hdul and errors requested by getdd.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">_in_svys</span><span class="p">)</span>
        <span class="n">imglt</span><span class="p">,</span> <span class="n">_error</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">_sam</span> <span class="o">=</span> <span class="n">sam</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#print(_in_svys)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_in_svys</span><span class="p">)):</span>
                    <span class="n">imglt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_imgl_pool</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">_in_svys</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">r</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span>  <span class="n">_sam</span><span class="p">[</span><span class="n">ind</span><span class="p">]])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">_error</span> <span class="o">=</span> <span class="s2">&quot;problem with survey: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_in_svys</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">_error</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">imglt</span><span class="p">,</span> <span class="n">_error</span>

    <span class="k">def</span> <span class="nf">_get_imgl_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests Fits from Skyview one by one. Written for multithread pooling.</span>
<span class="sd">        returns a list of hdul requested by _run_imgl</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">svy</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">_sam</span> <span class="o">=</span> <span class="n">cals</span>
        <span class="k">if</span> <span class="n">_sam</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">_sam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">imglr</span> <span class="o">=</span> <span class="n">skv</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">survey</span><span class="o">=</span><span class="n">svy</span><span class="p">,</span> <span class="n">pixels</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s2">&quot;Linear&quot;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">_sam</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
            <span class="n">queue</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">imglr</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_down</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># --- if file not found/doesn&#39;t exist. Program will continue.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not found &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svy</span><span class="p">))</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">queue</span>

    <span class="k">def</span> <span class="nf">_inp_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        sanitizing inputs: name, radius, position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#------------ name --#</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Anonymous&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">27</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">28</span><span class="p">]</span>

        <span class="c1">#---------- radius --#</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">))</span><span class="o">*</span><span class="n">ut</span><span class="o">.</span><span class="n">degree</span>

        <span class="c1">#----- coordinates --#</span>
        <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s1">&#39;fk5&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;success&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;success&quot;</span>
                <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot; Please check coordinates&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
            <span class="c1">#print(self.throw_output())</span>
            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span>

<div class="viewcode-block" id="RGBMaker.rgb_dict"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.rgb_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">rgb_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">combination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dictionary for creating RGB images and single survey images using svy_dict().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_sampling_b</span><span class="p">,</span> <span class="n">_r</span><span class="p">,</span> <span class="n">_g</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
        <span class="k">if</span> <span class="s2">&quot;iou&quot;</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;w22&#39;</span><span class="p">)</span>
            <span class="n">_g</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2r&#39;</span><span class="p">)</span>
            <span class="n">_b</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;gnuv&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;ror&quot;</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;tgss&#39;</span><span class="p">)</span>
            <span class="n">_g</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2r&#39;</span><span class="p">)</span>
            <span class="n">_b</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;nvss&#39;</span><span class="p">)</span>
            <span class="n">_sampling_b</span> <span class="o">=</span> <span class="s1">&#39;Lanczos3&#39;</span>
        <span class="k">elif</span> <span class="s2">&quot;optical&quot;</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2ir&#39;</span><span class="p">)</span>
            <span class="n">_g</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2r&#39;</span><span class="p">)</span>
            <span class="n">_b</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2b&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;single&quot;</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
            <span class="n">_g</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;dss2r&#39;</span><span class="p">)</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rgb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">_r</span><span class="p">,</span><span class="n">_g</span><span class="p">],</span> <span class="s1">&#39;sampler&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]}</span>
        <span class="k">elif</span> <span class="s2">&quot;allwise&quot;</span> <span class="ow">in</span> <span class="n">combination</span><span class="p">:</span>
            <span class="n">_r</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;w22&#39;</span><span class="p">)</span>
            <span class="n">_g</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;w4_6&#39;</span><span class="p">)</span>
            <span class="n">_b</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svy_dict</span><span class="p">(</span><span class="s1">&#39;w3_4&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rgb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">_r</span><span class="p">,</span><span class="n">_g</span><span class="p">,</span> <span class="n">_b</span><span class="p">],</span> <span class="s1">&#39;sampler&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rgb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">_r</span><span class="p">,</span> <span class="n">_g</span><span class="p">,</span> <span class="n">_b</span><span class="p">],</span> <span class="s1">&#39;sampler&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_sampling_b</span><span class="p">]}</span></div>
    
<div class="viewcode-block" id="RGBMaker.vz_query"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.vz_query">[docs]</a>    <span class="k">def</span> <span class="nf">vz_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        query from vizier for NVSS and TGSS.</span>
<span class="sd">        @returns:</span>
<span class="sd">            MajorAxis (unitless) (Vizier : arcsec), </span>
<span class="sd">            MinorAxis (unitless) (Vizier : arcsec),</span>
<span class="sd">            PA  (unitless) (Vizier : deg), </span>
<span class="sd">            pixel based position (single arguement)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_tgss_viz</span><span class="p">,</span> <span class="n">_nvss_viz</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagesopt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="n">_tviz</span> <span class="o">=</span> <span class="n">Vizier</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vzc_dict</span><span class="p">(</span><span class="s1">&#39;tgss&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vzb_dict</span><span class="p">(</span><span class="s1">&#39;tgss&#39;</span><span class="p">))</span>
                    <span class="n">_tra</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">]</span>  <span class="c1"># *ut.deg</span>
                    <span class="n">_tdec</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;DEJ2000&#39;</span><span class="p">]</span>  <span class="c1"># *ut.deg</span>
                    <span class="n">_tMaj</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Maj&#39;</span><span class="p">]</span>
                    <span class="n">_tMin</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Min&#39;</span><span class="p">]</span>
                    <span class="n">_s_tgss</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Stotal&#39;</span><span class="p">]</span>
                    <span class="n">_es_tgss</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;e_Stotal&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;PA&quot;</span> <span class="ow">in</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">_tPA</span> <span class="o">=</span> <span class="n">_tviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;PA&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_tPA</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">_center_tgss</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">_tra</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">_tdec</span><span class="p">)</span>
                    <span class="n">_center_tgss_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">_center_tgss</span><span class="p">)</span>
                    <span class="n">_tgss_viz</span> <span class="o">=</span> <span class="p">[</span><span class="n">_tMaj</span><span class="p">,</span> <span class="n">_tMin</span><span class="p">,</span> <span class="n">_tPA</span><span class="p">,</span> <span class="n">_center_tgss_px</span><span class="p">,</span> <span class="n">_s_tgss</span><span class="p">,</span> <span class="n">_es_tgss</span><span class="p">]</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">_nviz</span> <span class="o">=</span> <span class="n">Vizier</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vzc_dict</span><span class="p">(</span><span class="s1">&#39;nvss&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vzb_dict</span><span class="p">(</span><span class="s1">&#39;nvss&#39;</span><span class="p">))</span>
                    <span class="n">_nra</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>  <span class="c1"># .deg</span>
                    <span class="n">_ndec</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;DEJ2000&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>  <span class="c1"># .deg</span>
                    <span class="c1">#_nrad = coordinates.Angle(_nviz[0][&#39;RAJ2000&#39;], unit=ut.hour).deg</span>
                    <span class="c1">#_ndecd = coordinates.Angle(_nviz[0][&#39;DEJ2000&#39;], unit=ut.deg).deg for scatter plots</span>
                    <span class="n">_nMaj</span> <span class="o">=</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;MajAxis&quot;</span><span class="p">]</span>
                    <span class="n">_nMin</span> <span class="o">=</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;MinAxis&quot;</span><span class="p">]</span>
                    <span class="n">_s_nvss</span> <span class="o">=</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;S1.4&#39;</span><span class="p">]</span>
                    <span class="n">_es_nvss</span> <span class="o">=</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;e_S1.4&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;PA&quot;</span> <span class="ow">in</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="n">_nPA</span> <span class="o">=</span> <span class="n">_nviz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;PA&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_nPA</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">_center_nvss</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">_nra</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">_ndec</span><span class="p">)</span>
                    <span class="n">_center_nvss_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">_center_nvss</span><span class="p">)</span>
                    <span class="n">_nvss_viz</span> <span class="o">=</span> <span class="p">[</span><span class="n">_nMaj</span><span class="p">,</span> <span class="n">_nMin</span><span class="p">,</span> <span class="n">_nPA</span><span class="p">,</span> <span class="n">_center_nvss_px</span><span class="p">,</span> <span class="n">_s_nvss</span><span class="p">,</span> <span class="n">_es_nvss</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s2">&quot; no data in catalog&quot;</span>

        <span class="k">return</span> <span class="n">_tgss_viz</span><span class="p">,</span> <span class="n">_nvss_viz</span></div>

<div class="viewcode-block" id="RGBMaker.svy_dict"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.svy_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">svy_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">svy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dictionary for surveys to be used to fetch FITS from skyview using astroquery.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">svys</span> <span class="o">=</span> <span class="n">Surveys</span><span class="p">()</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svys</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">if</span> <span class="n">svy</span> <span class="ow">in</span> <span class="n">_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_dict</span><span class="p">[</span><span class="n">svy</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">svy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">svys</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_dict</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid survey. please choose one from </span><span class="si">{}</span><span class="s2"> or use any of &#39;*&#39; &#39;v&#39; &#39;k&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svy</span><span class="p">,</span> <span class="n">_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="RGBMaker.vzc_dict"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.vzc_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">vzc_dict</span><span class="p">(</span><span class="n">svy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        vizier column dictionary</span>
<span class="sd">        dictionary for NVSS, TGSS column using vizier</span>
<span class="sd">        TODO: add column for errors too</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tgss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;DEJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;Maj&#39;</span><span class="p">,</span> <span class="s1">&#39;Min&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;Stotal&#39;</span><span class="p">,</span> <span class="s1">&#39;e_Stotal&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;nvss&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RAJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;DEJ2000&#39;</span><span class="p">,</span> <span class="s1">&#39;MajAxis&#39;</span><span class="p">,</span> <span class="s1">&#39;MinAxis&#39;</span><span class="p">,</span> <span class="s1">&#39;PA&#39;</span><span class="p">,</span> <span class="s1">&#39;+NVSS&#39;</span><span class="p">,</span> <span class="s1">&#39; S1.4&#39;</span><span class="p">,</span> <span class="s1">&#39;e_S1.4&#39;</span><span class="p">]</span>
                   <span class="p">}</span>
        <span class="k">if</span> <span class="n">svy</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">columns</span><span class="p">[</span><span class="n">svy</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">columns</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid survey. please choose one from </span><span class="si">{}</span><span class="s2"> or use any of &#39;*&#39; &#39;v&#39; &#39;k&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svy</span><span class="p">,</span> <span class="n">columns</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="RGBMaker.vzb_dict"><a class="viewcode-back" href="../index.html#rgbmaker.RGBMaker.vzb_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">vzb_dict</span><span class="p">(</span><span class="n">svy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        vizier base dictionary</span>
<span class="sd">        dictionary for NVSS, TGSS catalog using vizier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tgss&#39;</span><span class="p">:</span> <span class="s1">&#39;J/A+A/598/A78/table3&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nvss&#39;</span><span class="p">:</span> <span class="s1">&#39;VIII/65/nvss&#39;</span>
                <span class="p">}</span>
        <span class="k">if</span> <span class="n">svy</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span><span class="p">[</span><span class="n">svy</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">svy</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid survey. please choose one from </span><span class="si">{}</span><span class="s2"> or use any of &#39;*&#39; &#39;v&#39; &#39;k&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svy</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div></div>

<div class="viewcode-block" id="Surveys"><a class="viewcode-back" href="../index.html#rgbmaker.Surveys">[docs]</a><span class="k">class</span> <span class="nc">Surveys</span><span class="p">(</span><span class="n">RGBMaker</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tgss&#39;</span><span class="p">:</span> <span class="s1">&#39;TGSS ADR1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nvss&#39;</span><span class="p">:</span> <span class="s1">&#39;NVSS&#39;</span><span class="p">,</span>
                <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="s1">&#39;VLA FIRST (1.4 GHz)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dss2r&#39;</span><span class="p">:</span> <span class="s1">&#39;DSS2 Red&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dss2ir&#39;</span><span class="p">:</span> <span class="s1">&#39;DSS2 IR&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dss2b&#39;</span><span class="p">:</span> <span class="s1">&#39;DSS2 Blue&#39;</span><span class="p">,</span>
                <span class="s1">&#39;w22&#39;</span><span class="p">:</span> <span class="s1">&#39;WISE 22&#39;</span><span class="p">,</span>
                <span class="s1">&#39;w12&#39;</span><span class="p">:</span> <span class="s1">&#39;WISE 12&#39;</span><span class="p">,</span>
                <span class="s1">&#39;w4_6&#39;</span><span class="p">:</span> <span class="s1">&#39;WISE 4.6&#39;</span><span class="p">,</span>
                <span class="s1">&#39;w3_4&#39;</span><span class="p">:</span> <span class="s1">&#39;WISE 3.4&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gnuv&#39;</span><span class="p">:</span> <span class="s1">&#39;GALEX Near UV&#39;</span><span class="p">}</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, avialxee.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>